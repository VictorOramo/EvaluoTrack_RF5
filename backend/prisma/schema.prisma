generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [postgis, uuid_ossp(map: "uuid-ossp", schema: "extensions")]
}

model Expediente {
  id                  String           @id @default(uuid())
  numeroExpediente    String           @unique
  nombreSolicitante   String
  cedulaSolicitante   String
  telefonoSolicitante String?
  emailSolicitante    String?
  direccionInmueble   String
  municipio           String
  provincia           String
  estado              EstadoExpediente @default(PENDIENTE)
  fechaCreacion       DateTime         @default(now())
  fechaActualizacion  DateTime         @updatedAt
  anexos              Anexo[]
  fichaCatastral      FichaCatastral?

  @@map("expedientes")
}

model FichaCatastral {
  id                    String              @id @default(uuid())
  expedienteId          String              @unique
  areaTerreno           Float
  areaConstruida        Float?
  tipoInmueble          TipoInmueble
  numeroPisos           Int?
  numeroHabitaciones    Int?
  numeroBanos           Int?
  antiguedad            Int?
  estadoConservacion    EstadoConservacion?
  tituloPropiedadNumero String?
  registroPropiedad     String?
  situacionLegal        SituacionLegal      @default(REGULAR)
  valorTerreno          Float?
  valorConstruccion     Float?
  valorTotal            Float?
  moneda                String              @default("DOP")
  fechaCreacion         DateTime            @default(now())
  fechaActualizacion    DateTime            @updatedAt
  expediente            Expediente          @relation(fields: [expedienteId], references: [id], onDelete: Cascade)

  @@map("fichas_catastrales")
}

model Anexo {
  id            String                   @id @default(uuid())
  expedienteId  String
  tipoAnexo     TipoAnexo
  nombreArchivo String
  rutaArchivo   String
  tamanoBytes   Int
  mimeType      String
  coordenadas   Unsupported("geometry")?
  descripcion   String?
  fechaSubida   DateTime                 @default(now())
  expediente    Expediente               @relation(fields: [expedienteId], references: [id], onDelete: Cascade)

  @@index([expedienteId])
  @@map("anexos")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

enum EstadoExpediente {
  PENDIENTE
  EN_PROCESO
  EN_REVISION
  APROBADO
  RECHAZADO
}

enum TipoInmueble {
  RESIDENCIAL
  COMERCIAL
  INDUSTRIAL
  AGRICOLA
  SOLAR
  MIXTO
}

enum EstadoConservacion {
  EXCELENTE
  BUENO
  REGULAR
  MALO
  RUINA
}

enum SituacionLegal {
  REGULAR
  IRREGULAR
  EN_PROCESO
  LITIGIO
}

enum TipoAnexo {
  FOTOGRAFIA
  PLANO
  TITULO_PROPIEDAD
  DOCUMENTO_IDENTIFICACION
  COORDENADAS
  OTRO
}
